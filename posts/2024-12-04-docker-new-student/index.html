<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Docker New Student | CJY'Log</title>
<meta name=keywords content="skill,docker"><meta name=description content="This note details the process of creating and configuring a development environment with CUDA support using Docker, from initializing the container and installing the necessary packages such as vim, nano, git, openssh-server, etc., to configuring SSH to allow root to log in and set the root password, and configuring the nvcc environment variable for the user to ensure that the CUDA toolchain is available.
It also describes how to clear the command history to maintain privacy and save the configured container as a new image version (4.0)."><meta name=author content="CJY"><link rel=canonical href=https://cjy1018.github.io/posts/2024-12-04-docker-new-student/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=../../assets/css/stylesheet.8fec53bf5d70c976a3397700fd8c8a2255032c73bc6f027f0780698c700e4e10.css integrity="sha256-j+xTv11wyXajOXcA/YyKIlUDLHO8bwJ/B4BpjHAOThA=" rel="preload stylesheet" as=style><link rel=icon href=https://cjy1018.github.io/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://cjy1018.github.io/favicon.png><link rel=icon type=image/png sizes=32x32 href=https://cjy1018.github.io/favicon.png><link rel=apple-touch-icon href=https://cjy1018.github.io/favicon.png><link rel=mask-icon href=https://cjy1018.github.io/favicon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://cjy1018.github.io/posts/2024-12-04-docker-new-student/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=text/javascript async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"})</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style><meta property="og:url" content="https://cjy1018.github.io/posts/2024-12-04-docker-new-student/"><meta property="og:site_name" content="CJY'Log"><meta property="og:title" content="Docker New Student"><meta property="og:description" content="This note details the process of creating and configuring a development environment with CUDA support using Docker, from initializing the container and installing the necessary packages such as vim, nano, git, openssh-server, etc., to configuring SSH to allow root to log in and set the root password, and configuring the nvcc environment variable for the user to ensure that the CUDA toolchain is available.
It also describes how to clear the command history to maintain privacy and save the configured container as a new image version (4.0)."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-04T12:38:14+08:00"><meta property="article:modified_time" content="2024-12-04T12:38:14+08:00"><meta property="article:tag" content="Skill"><meta property="article:tag" content="Docker"><meta property="og:image" content="https://cjy1018.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cjy1018.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Docker New Student"><meta name=twitter:description content="This note details the process of creating and configuring a development environment with CUDA support using Docker, from initializing the container and installing the necessary packages such as vim, nano, git, openssh-server, etc., to configuring SSH to allow root to log in and set the root password, and configuring the nvcc environment variable for the user to ensure that the CUDA toolchain is available.
It also describes how to clear the command history to maintain privacy and save the configured container as a new image version (4.0)."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://cjy1018.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Docker New Student","item":"https://cjy1018.github.io/posts/2024-12-04-docker-new-student/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Docker New Student","name":"Docker New Student","description":"This note details the process of creating and configuring a development environment with CUDA support using Docker, from initializing the container and installing the necessary packages such as vim, nano, git, openssh-server, etc., to configuring SSH to allow root to log in and set the root password, and configuring the nvcc environment variable for the user to ensure that the CUDA toolchain is available.\nIt also describes how to clear the command history to maintain privacy and save the configured container as a new image version (4.0).\n","keywords":["skill","docker"],"articleBody":"This note details the process of creating and configuring a development environment with CUDA support using Docker, from initializing the container and installing the necessary packages such as vim, nano, git, openssh-server, etc., to configuring SSH to allow root to log in and set the root password, and configuring the nvcc environment variable for the user to ensure that the CUDA toolchain is available.\nIt also describes how to clear the command history to maintain privacy and save the configured container as a new image version (4.0).\nThe documentation then describes the process of creating a new user based on this customized image, including adding the user to the host, obtaining his or her UID and GID, and then starting a new Docker container with this information while mapping the user’s home directory inside the container.\nFinally, the note mention changing the ownership of the user’s folder to the newly created user and suggest future improvements that can be made to automate this series of steps by writing Dockerfiles and scripts. The entire process demonstrates the complete flow of building a Docker development environment from scratch suitable for deep learning or other GPU-accelerated tasks.\n修改docker权限 1 newgrp docker 从原始容器中创建模板 创建并进入容器 1 2 3 docker run --gpus all -itd --name username --hostname host-57 -p 10023:22 dockerpull.org/nvidia/cuda:12.6.3-cudnn-devel-ubuntu24.04 docker exec -it username /bin/bash 更新并安装包 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 apt update apt install vim 5 69 apt install nano apt install git apt install openssh-server apt install sudo apt install python-is-python3 apt install python3-pip apt install iputils-ping apt install --reinstall ubuntu-standard 删除unminimize提示 1 rm -f /etc/update-motd.d/60-unminimize 修改ssh 1 2 3 vim /etc/ssh/sshd_config PermitRootLogin yes 设置root密码 1 host12345 配置用户nvcc环境 1 vim /etc/skel/.bashrc 1 2 3 4 5 # Set up CUDA environment variables if [ -d /usr/local/cuda/bin ]; then export PATH=/usr/local/cuda/bin${PATH:+:${PATH}} export LD_LIBRARY_PATH=/usr/local/cuda/lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}} fi 清除历史记录 1 2 3 echo -n \"\" \u003e ~/.bash_history history -r history -c 保存容器到镜像(4.0) 1 2 3 docker ps docker commit -a cjy -m 保存容器到镜像 docker_id newstudent:4.0 从模板中创建新用户 在主机中创建新用户 1 adduser --home /media/disk/home/username username 获取用户UID和GID 1 id username 从模板中创建容器并进入 1 2 3 docker run -u uid:gid --gpus all -itd --name username --hostname host-57 -p 10000:22 -p 10001-10009:10001-10009 -v /media/disk/home/username:/home/username newstudent:4.0 docker exec -it username /bin/bash 更改用户的UID和GID 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 su # 创建用户组GID groupadd -g gid username # 创建用户 adduser --uid uid --gid gid username # 复制.bashrc到用户home目录 cp -r /etc/skel/. /home/lxy/ # 重启ssh service ssh restart # 清除历史记录 echo -n \"\" \u003e ~/.bash_history history -r history -c # 切换到用户 su username # 清除历史记录 echo -n \"\" \u003e ~/.bash_history history -r history -c 将用户文件夹所有者从root修改为用户自身 1 2 # 一般文件权限755，文件夹权限644 chown -R 1003:1003 /home/username TODO: 使用Dockerfile和脚本化 ","wordCount":"469","inLanguage":"en","image":"https://cjy1018.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-12-04T12:38:14+08:00","dateModified":"2024-12-04T12:38:14+08:00","author":{"@type":"Person","name":"CJY"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://cjy1018.github.io/posts/2024-12-04-docker-new-student/"},"publisher":{"@type":"Organization","name":"CJY'Log","logo":{"@type":"ImageObject","url":"https://cjy1018.github.io/favicon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://cjy1018.github.io/ accesskey=h title="CJY'Log (Alt + H)"><img src=https://cjy1018.github.io/apple-touch-icon.png alt aria-label=logo height=35>CJY'Log</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://cjy1018.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://cjy1018.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://cjy1018.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://cjy1018.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://cjy1018.github.io/faq/ title=FAQ><span>FAQ</span></a></li><li><a href=https://lilianweng.github.io/ title=Lil’Log><span>Lil’Log</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://cjy1018.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://cjy1018.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Docker New Student</h1><div class=post-meta><span>Date: December 4, 2024</span>
<span>&nbsp;|&nbsp;</span>
<span>Estimated Reading Time: 3 min</span>
<span>&nbsp;|&nbsp;</span>
<span>Author: CJY</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#修改docker权限>修改docker权限</a></li><li><a href=#从原始容器中创建模板>从原始容器中创建模板</a><ul><li><a href=#创建并进入容器>创建并进入容器</a></li><li><a href=#更新并安装包>更新并安装包</a></li><li><a href=#删除unminimize提示>删除unminimize提示</a></li><li><a href=#修改ssh>修改ssh</a></li><li><a href=#设置root密码>设置root密码</a></li><li><a href=#配置用户nvcc环境>配置用户nvcc环境</a></li><li><a href=#清除历史记录>清除历史记录</a></li><li><a href=#保存容器到镜像40>保存容器到镜像(4.0)</a></li></ul></li><li><a href=#从模板中创建新用户>从模板中创建新用户</a><ul><li><a href=#在主机中创建新用户>在主机中创建新用户</a></li><li><a href=#获取用户uid和gid>获取用户UID和GID</a></li><li><a href=#从模板中创建容器并进入>从模板中创建容器并进入</a></li><li><a href=#更改用户的uid和gid>更改用户的UID和GID</a></li><li><a href=#将用户文件夹所有者从root修改为用户自身>将用户文件夹所有者从root修改为用户自身</a></li></ul></li><li><a href=#todo-使用dockerfile和脚本化>TODO: 使用Dockerfile和脚本化</a></li></ul></nav></div></details></div><div class=post-content><p>This note details the process of creating and configuring a development environment with CUDA support using Docker, from initializing the container and installing the necessary packages such as vim, nano, git, openssh-server, etc., to configuring SSH to allow root to log in and set the root password, and configuring the nvcc environment variable for the user to ensure that the CUDA toolchain is available.</p><p>It also describes how to clear the command history to maintain privacy and save the configured container as a new image version (4.0).</p><p>The documentation then describes the process of creating a new user based on this customized image, including adding the user to the host, obtaining his or her UID and GID, and then starting a new Docker container with this information while mapping the user&rsquo;s home directory inside the container.</p><p>Finally, the note mention changing the ownership of the user&rsquo;s folder to the newly created user and suggest future improvements that can be made to automate this series of steps by writing Dockerfiles and scripts. The entire process demonstrates the complete flow of building a Docker development environment from scratch suitable for deep learning or other GPU-accelerated tasks.</p><h2 id=修改docker权限>修改docker权限<a hidden class=anchor aria-hidden=true href=#修改docker权限>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>newgrp docker
</span></span></code></pre></td></tr></table></div></div><br><h2 id=从原始容器中创建模板>从原始容器中创建模板<a hidden class=anchor aria-hidden=true href=#从原始容器中创建模板>#</a></h2><h3 id=创建并进入容器>创建并进入容器<a hidden class=anchor aria-hidden=true href=#创建并进入容器>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --gpus all -itd --name username --hostname host-57 -p 10023:22  dockerpull.org/nvidia/cuda:12.6.3-cudnn-devel-ubuntu24.04 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it username /bin/bash
</span></span></code></pre></td></tr></table></div></div><br><h3 id=更新并安装包>更新并安装包<a hidden class=anchor aria-hidden=true href=#更新并安装包>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>apt update
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apt install vim <span class=m>5</span> <span class=m>69</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apt install nano
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apt install git
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apt install openssh-server
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apt install sudo
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apt install python-is-python3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apt install python3-pip
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apt install iputils-ping
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apt install --reinstall ubuntu-standard
</span></span></code></pre></td></tr></table></div></div><br><h3 id=删除unminimize提示>删除unminimize提示<a hidden class=anchor aria-hidden=true href=#删除unminimize提示>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>rm -f /etc/update-motd.d/60-unminimize
</span></span></code></pre></td></tr></table></div></div><br><h3 id=修改ssh>修改ssh<a hidden class=anchor aria-hidden=true href=#修改ssh>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim /etc/ssh/sshd_config
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PermitRootLogin yes
</span></span></code></pre></td></tr></table></div></div><br><h3 id=设置root密码>设置root密码<a hidden class=anchor aria-hidden=true href=#设置root密码>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>host12345
</span></span></code></pre></td></tr></table></div></div><br><h3 id=配置用户nvcc环境>配置用户nvcc环境<a hidden class=anchor aria-hidden=true href=#配置用户nvcc环境>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim /etc/skel/.bashrc
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Set up CUDA environment variables</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> -d /usr/local/cuda/bin <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span>/usr/local/cuda/bin<span class=si>${</span><span class=nv>PATH</span><span class=p>:+:</span><span class=si>${</span><span class=nv>PATH</span><span class=si>}}</span>
</span></span><span class=line><span class=cl>    <span class=nb>export</span> <span class=nv>LD_LIBRARY_PATH</span><span class=o>=</span>/usr/local/cuda/lib64<span class=si>${</span><span class=nv>LD_LIBRARY_PATH</span><span class=p>:+:</span><span class=si>${</span><span class=nv>LD_LIBRARY_PATH</span><span class=si>}}</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></td></tr></table></div></div><br><h3 id=清除历史记录>清除历史记录<a hidden class=anchor aria-hidden=true href=#清除历史记录>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> -n <span class=s2>&#34;&#34;</span> &gt; ~/.bash_history
</span></span><span class=line><span class=cl><span class=nb>history</span> -r
</span></span><span class=line><span class=cl><span class=nb>history</span> -c
</span></span></code></pre></td></tr></table></div></div><br><h3 id=保存容器到镜像40>保存容器到镜像(4.0)<a hidden class=anchor aria-hidden=true href=#保存容器到镜像40>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker ps
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker commit -a cjy -m 保存容器到镜像 docker_id newstudent:4.0
</span></span></code></pre></td></tr></table></div></div><br><h2 id=从模板中创建新用户>从模板中创建新用户<a hidden class=anchor aria-hidden=true href=#从模板中创建新用户>#</a></h2><h3 id=在主机中创建新用户>在主机中创建新用户<a hidden class=anchor aria-hidden=true href=#在主机中创建新用户>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>adduser --home /media/disk/home/username username
</span></span></code></pre></td></tr></table></div></div><br><h3 id=获取用户uid和gid>获取用户UID和GID<a hidden class=anchor aria-hidden=true href=#获取用户uid和gid>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>id username
</span></span></code></pre></td></tr></table></div></div><br><h3 id=从模板中创建容器并进入>从模板中创建容器并进入<a hidden class=anchor aria-hidden=true href=#从模板中创建容器并进入>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -u uid:gid --gpus all -itd --name username --hostname host-57 -p 10000:22 -p 10001-10009:10001-10009 -v /media/disk/home/username:/home/username newstudent:4.0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it username /bin/bash
</span></span></code></pre></td></tr></table></div></div><br><h3 id=更改用户的uid和gid>更改用户的UID和GID<a hidden class=anchor aria-hidden=true href=#更改用户的uid和gid>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>su
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建用户组GID</span>
</span></span><span class=line><span class=cl>groupadd -g gid username
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建用户</span>
</span></span><span class=line><span class=cl>adduser --uid uid --gid gid username
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 复制.bashrc到用户home目录</span>
</span></span><span class=line><span class=cl>cp -r /etc/skel/. /home/lxy/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 重启ssh</span>
</span></span><span class=line><span class=cl>service ssh restart
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 清除历史记录</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -n <span class=s2>&#34;&#34;</span> &gt; ~/.bash_history
</span></span><span class=line><span class=cl><span class=nb>history</span> -r
</span></span><span class=line><span class=cl><span class=nb>history</span> -c
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 切换到用户</span>
</span></span><span class=line><span class=cl>su username
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 清除历史记录</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -n <span class=s2>&#34;&#34;</span> &gt; ~/.bash_history
</span></span><span class=line><span class=cl><span class=nb>history</span> -r
</span></span><span class=line><span class=cl><span class=nb>history</span> -c
</span></span></code></pre></td></tr></table></div></div><br><h3 id=将用户文件夹所有者从root修改为用户自身>将用户文件夹所有者从root修改为用户自身<a hidden class=anchor aria-hidden=true href=#将用户文件夹所有者从root修改为用户自身>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 一般文件权限755，文件夹权限644</span>
</span></span><span class=line><span class=cl>chown -R 1003:1003 /home/username
</span></span></code></pre></td></tr></table></div></div><br><h2 id=todo-使用dockerfile和脚本化>TODO: 使用Dockerfile和脚本化<a hidden class=anchor aria-hidden=true href=#todo-使用dockerfile和脚本化>#</a></h2></div><footer class=post-footer><ul class=post-tags><li><a href=https://cjy1018.github.io/tags/skill/>Skill</a></li><li><a href=https://cjy1018.github.io/tags/docker/>Docker</a></li></ul><nav class=paginav><a class=next href=https://cjy1018.github.io/posts/2024-12-03-hugo/><span class=title>Next »</span><br><span>Hugo</span></a></nav></footer><div id=tw-comment></div><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="light"?"light":"dark_high_contrast",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"CJY1018/cjy1018.github.io","data-repo-id":"R_kgDONRywJg","data-category":"Announcements","data-category-id":"DIC_kwDONRywJs4Ckar8","data-mapping":"title","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"zh-CN","data-loading":"lazy",crossorigin:"anonymous"},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#tw-comment").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2024 <a href=https://cjy1018.github.io/>CJY'Log</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>